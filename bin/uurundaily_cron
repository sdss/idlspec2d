#!/bin/bash


#### crontab:
## SHELL=/bin/bashSHELL=/bin/bash
## BASH_ENV=/uufs/chpc.utah.edu/common/home/eboss/crontab/.bashrc
## MAILTO=eboss-user@sdss.org
##
## */15 * * * * /uufs/chpc.utah.edu/common/home/eboss/daily/cmd/uurundaily_cron
####

####
# Suggested installation is to create a ln -s from this file to ~eboss/daily/cmd
####


daily=false
lco=false
run2d=''
while getopts "tlr:" argname; do
    case $argname in
      l) lco=true ;;
      t) daily=true ;;
      r) run2d=$OPTARG ;;
      *) usage ;;
    esac
done

if $daily; then
    ver_log='/DAILY'$run2d
    ver_flag=' -t'
else
    ver_log='/MASTER'
    ver_flag=''
fi
if $lco; then
    obs_log='/LCO'
    obs_flag=' -l'
else
    obs_log='/APO'
    obs_flag=''
fi

if [ $run2d != '' ]; then 
    run_flag=' -r '$run2d
else
    run_flag=''
fi

if [ -d $HOME/daily ]; then
    ###  Start logging

    timestamp=`date "+%m%d%Y"`
    LOGDIR=$HOME/daily/logs${obs_log}${ver_log}
    LOGFILE=$LOGDIR/daily$timestamp.log
    exec >>$LOGFILE 2<&1

    ###  Use this to temporarily turn off script
    #exec echo "turned off at $(date)"

    ###  Start Script

    date=$(date)
    echo "UURUNDAILY_CRON: ========================================"
    echo "UURUNDAILY_CRON: Starting at $date"
    $HOME/daily/cmd/uurundaily -g $ver_flag $obs_flag $run_flag
    date=$(date)
    echo "UURUNDAILY_CRON: Completing at $date"

else
    echo "UURUNDAILY_CRON: Aborting! User $USER does not have a daily directory"
fi
