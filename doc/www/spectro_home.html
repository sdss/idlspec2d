<HTML>
<HEAD>
<TITLE>Princeton SDSS Spectroscopy Home Page</TITLE>
</HEAD>

<BODY>

<BASE TARGET="_top">

<BODY>

<H1><CENTER>Princeton SDSS Spectroscopy Home Page</CENTER></H1>

<P>
This page should get SDSS Collaborators started using the spectra within
minutes.  To retrieve the data you need permissions set for copying data
from Princeton (<A HREF="#get_where">see below</A>).  Unfortunately, we
have not been able to copy recent data to the Fermilab computers, though
some older reductions are available there.
This page describes tools to view, query and use these data using IDL,
SuperMongo or IRAF.  There are also <A HREF="#summary">summary ASCII files</A>
that contain positions, magnitudes, classification information, and redshifts.

<P>
In this document:
<UL>
  <LI><A HREF="#plots">Some Nifty Plots</A>
  <LI><A HREF="#get_data">Getting the Reduced Data</A>
  <OL>
     <LI><A HREF="#platelist">Which Plates Are Reduced?</A> (<A HREF="platelist.txt">platelist.txt</A>)
     <LI><A HREF="#duplicates">Avoiding Duplicate Objects</A>
     <LI><A HREF="#get_version">What Version of the Code Was Used?</A>
     <LI><A HREF="#get_where">Where Is the Data?</A>
     <LI><A HREF="#get_rsync">How to Keep Your Data Up-to-Date</A>
  </OL>
  <LI><A HREF="#summary">What Is the Summary File?</A>
  <LI><A HREF="#display">Looking at the Data</A>
  <OL>
     <LI><A HREF="#idlsetup">Setting Up IDL Tools</A>
     <LI><A HREF="#idldisplay">Displaying the Spectra From IDL</A>
     <LI><A HREF="#smdisplay">Displaying the Spectra From SM</A>
     <LI><A HREF="#irafdisplay">Displaying the Spectra From IRAF</A>
     <LI><A HREF="#irafphist">Pat Hall's IRAF SDSS Tasks</A>
  </OL>
  <LI><A HREF="#special">"Special" Plates</A>
  <LI><A HREF="#datamodel">What Is the Data Model?</A>
  <LI><A HREF="#targetflags">What Are the Target Flags?</A>
  <LI><A HREF="#vacuum">The Wavelengths Are in Vacuum!!??</A>
  <LI><A HREF="#problems">Problems</A>
  <OL>
     <LI><A HREF="#problems_known">Known Problems</A>
     <LI><A HREF="#problems_failed">Failed Plates</A>
     <LI><A HREF="#problems_dates">Dates and Plates to Remember</A>
     <LI><A HREF="#problems_report">How to Report Problems</A>
  </OL>
</UL>

<P>
Related documents:
<UL>
  <LI><A HREF="idlspec2d_install.html">Installing the Spectro-2D + Princeton-1D</A> <-- Publicly available code
  <LI><A HREF="spectro_inspect.html">Manual Inspection of Spectra</A>
  <LI><A HREF="idlspec2d_reduce.html">Reducing <B>raw</B> spectroscopic data</A>
  <LI>Full documentation: <A HREF="idlspec2d_doc.html">idlspec2d</A>
  <LI>Full documentation: <A HREF="idlutils_doc.html">idlutils</A>
  <LI>Full documentation: <A HREF="goddard_doc.html">Goddard IDL utilities</A>
</UL>

<P>
Related web sites:
<UL>
  <LI><A HREF="http://www.sdss.org/">Official SDSS Web Site</A>
  <LI>The <A HREF="http://astro.Princeton.EDU/BBOOK/">"Black Book"</A>
      and the
      <A HREF="http://www.astro.princeton.edu/PBOOK/welcome.htm">
      "Project Book"</A>
  <LI><A HREF="http://www.astro.princeton.edu:81/">Princeton SDSS Web Site</A>
      (restricted access)
  <LI><A HREF="http://www.astro.washington.edu/anderson/sdss/serendip/odd_spectra.html">Scott Anderson's Odd Spectrum Page</A>
  <LI><A HREF="http://plate-mapper.apo.nmsu.edu:8020/topFrame.html">
      Plate Inventory Database</A> (restricted access)
  <LI><A HREF="http://www-sdss.fnal.gov:8000/~sdssdp/target/chunks.html">
      Fermi ``Chunk'' List</A> (restricted access)
<!--
  <LI><A HREF="http://sdss.fnal.gov:8000/~danvb/spectra/specids.html">
      Van den Berk's manual classifications</A> (restricted access)
  <LI><A HREF="http://sdss.fnal.gov:8000/qwg/spectra/specids.html">
      Van den Berk's manual classifications for EDR</A> (restricted access)
-->
  <LI><A HREF="http://physics.nyu.edu/~mb144/lss/">
      Mike Blanton's LSS Sample</A>
</UL>

<P>
Related mailing lists (restricted access):
<UL>
  <LI>Spectroscopic pipeline
      <A HREF="http://www.astro.princeton.edu:81/sdss-spectro/INDEX.html">
      (sdss-spectro)</A>
  <LI>Spectroscopic commissioning
      <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/INDEX.html">
      (sdss-spcommish)</A>
  <LI>Hand-written observing logs (imaging + spectroscopy)
      <A HREF="http://www.astro.princeton.edu:81/sdss-25mlog/INDEX.html">
      (sdss-25mlog)</A>
  <LI>Spectro auto-generated observing logs
      <A HREF="http://www.astro.princeton.edu:81/sdss-speclog/INDEX.html">
      (sdss-speclog)</A>;
      or <A HREF="http://sos.apo.nmsu.edu/logfile-current.html">current log</A>

</UL>

<HR>

<H2><A NAME="plots">Some Nifty Plots</A></H2>

<P>
Plot of <A HREF="platehist.ps">the cumulative number of survey-quality
spectra.</A>

<P>
Here are some nifty plots of only those objects within 2 degrees of the
equatorial plane:
<OL>
<LI><A HREF="zplot-main.ps">Pie diagram to z=0.15</A>
<LI><A HREF="zplot-brg.ps">Pie diagram to z=0.6</A>
<LI><A HREF="zplot-qso.ps">Pie diagram to z=5</A>
<LI><A HREF="zplot-log.ps">Logarithmically-spaced pie diagram</A>
</OL>
(On a PostScript previewer, turn off State->Antialias.)
The Milky Way is masked with dashed lines.  The MAIN galaxy sample are
black points, the luminous red galaxies (LRGs) that are not in MAIN are red,
and quasars are blue.

<H2><A NAME="get_data">Getting the Reduced Data</A></H2>

<H4><A NAME="platelist">Which Plates Are Reduced?</A></H4>

<P>
The SDSS will observe approximately 2000 plates by the end of
its 5 year survey.  Each plate is physically an aluminum disk 60 cm
in diameter that subtends 3 degrees on the sky.
640 fibers are plugged into each plate at the location of objects chosen from
the photometric survey, allowing us to spectroscopically observe 640
objects at time.  Typically, we integrate for 45 minutes on each plate.

<P>
Since plates are occasionally re-observed, the plate number plus the
observation date uniquely identifies an observation.  We track the
date with modified Julian date (MJD).  In these re-observations,
the optical fibers may be plugged into different holes, so fiber #1 on
plate 306 won't be the same on the MJD=51637 observation as on MJD=51690.

<P>
Therefore, PLATE + MJD + FIBERID uniquely determines a single observation
of a single object.  The TILE number uniquely determines a position on the
sky, and there are a few instances where two PLATEs are drilled for one TILE.

<P>
<A HREF="platelist.txt">This list of plates  (platelist.txt)
is auto-updated each day based upon which reductions have completed.</A>
To date (Feb 2002), we have observed over 500 plates.
This list comes from a FITS file (<A HREF="platelist.fits">platelist.fits</A>)
which contains considerably more information than the ASCII list.

<P>
Aside from PLATE, TILE and MJD, this list contains the following:
<PRE>
RA       = Right ascension of plate center [J2000 degrees].
DEC      = Declination of plate center [J2000 degrees].
MAPNAME  = Mapping name for this plate; data with the same mapping name
           are always combined into one plate file, even if taken on
           different nights.
VERSLOG  = Version of speclog product (spectroscopic log files).
VERSUTIL = Version of idlutils product.
VERSFLAT = Version of specflat product (spectroscopic pixel flats).
VERSREAD = Version of Spectro-2D code for pre-processing raw data.
VERS2D   = Version of Spectro-2D code to reduce the individual frames.
VERSCOMB = Version of Spectro-2D code to combine frames into a plate file.
VERS1D   = Version of Princeton-1D code to measure redshifts.
VERSTARG = Version of Target code for selecting the objects on this plate.
CHUNKNAME= The name of the Target and tiling run which produced this plate.
NEXP     = Total number of frames from all cameras used in the co-adding;
           since there are 4 cameras, NEXP=12 would typically mean that there
           were 3 exposures in each camera.
EXPT_B1  = Total exposure time in b1 camera.
EXPT_B2  = Total exposure time in b2 camera.
EXPT_R1  = Total exposure time in r1 camera.
EXPT_R2  = Total exposure time in r2 camera.
SMEARUSE = Set to 'T' if the spectra were normalized to a smear exposure,
           which is effectively a 1-minute exposure on a 5 x 7 arcsec
           aperature.
SN2_G1   = (S/N)^2 per pixel at g=20.2 on spectrograph #1.
SN2_G2   = (S/N)^2 per pixel at g=20.2 on spectrograph #2.
SN2_R1   = (S/N)^2 per pixel at r=20.25 on spectrograph #1.
SN2_R2   = (S/N)^2 per pixel at r=20.25 on spectrograph #2.
SN2_I1   = (S/N)^2 per pixel at i=19.9 on spectrograph #1.
SN2_I2   = (S/N)^2 per pixel at i=19.9 on spectrograph #2.
N_GALAXY = The number of objects Princeton-1D called a galaxy.
N_QSO    = The number of objects Princeton-1D called a QSO.
N_STAR   = The number of objects Princeton-1D called a star.
N_UNKNOWN= The number of objects Princeton-1D declared spectroscopically 
           unknown (a ZWARNING flag is set)
N_SKY    = The number of sky fibers (almost always exactly 32)
STATUS2D = Status of Spectro-2D pipeline for reducing individual exposures;
           "Done" if done.
STATUSCOMBINE = Status of Spectro-2D pipeline for combining individual
           exposures into the spPlate files; "Done" if done.
STATUS1D = Status of Princeton-1D pipeline; "Done" if done.
QSURVEY  = Status flag set to 1 for the best observation of any tile on the sky
           that satifies the following: (S/N)^2 > 13.0 for G1,G2,I1,I2, and
           the target version cannot be "special" or "devel".
PUBLIC   = Name of public data release; presently plates are either not public,
           or part of the early data release (EDR).
</PRE>

<P>
The values of SN2 give an estimate of the signal-to-noise (per pixel) of a plate
at a fiducial magnitude.  The fiducials are set to g=20.2, r=20.25, i=19.9.
The measurement is of the signal-to-noise squared, per pixel, for an object
at that magnitude.  If all these values are > 13, then the plate is "good".
Plate 310 is "not good".  The first observation of plate 302
would be called "horrible".

<H4><A NAME="duplicates">Avoiding Duplicate Objects</A></H4>

<P>
Selecting only those plates with QSURVEY=1 will yield non-duplicate
observations of tiles on the sky that meet the survey requirements
for signal-to-noise.  There still may be a few duplicate objects,
as some objects are put on multiple tiles for "quality assurance".
These duplicates can be identified with OBJTYPE="QA".  That OBJTYPE
column exists either in HDU #5 of the <A HREF="#datamodel">spPlate files</A>,
or in a column by that name in the <A HREF="#summary">spAll summary files</A>.

<P>
Note that the above statements are almost but not exactly true.
There were some target-selection errors that resulted in duplicated
targets not labelled as "QA" (notably in runs 94 and 125; see
<A HREF="http://www.astro.princeton.edu:81/sdss-spectro/msg.710.html">sdss-spectro/710</A>).
The following IDL commands can be used to select a truly unique set
of objects:
<DL><DD><PRE>
  IDL> spall = mrdfits('spAll-qsurvey.fits',1)
  IDL> spall = spall[where(strmatch(spall.objtype, 'QA*') EQ 0)]
  IDL> junk = djs_angle_group(spall.plug_ra, spall.plug_dec, 1./3600, $
       gindx=gindx, gstart=gstart, gcount=gcount)
  IDL> spall = spall[gindx[gstart]]
</PRE></DD></DL>
The above removes "QA" objects, then selects the first instance of any
remaining duplicates.  The procedure DJS_ANGLE_GROUP() is not speedy,
and may take about an hour.

<H4><A NAME="get_version">What Version of the Code Was Used?</A></H4>

<P>
The version of the code used in the reductions is specified in the
header keywords VERS2D, VERSCOMB, VERS1D as described in the
<A HREF="#datamodel">data model</A>.

<P>
All these reductions were done using versions of the code tagged v4_8_4,
which represents a homogeneous set of reductions.

<H4><A NAME="get_where">Where Is the Data?</A></H4>

<P>
The spectroscopic data is reduced at Princeton, typically within 12 hours
of the data being taken.  These reductions are available directly from
Princeton as described below.  We have been unable to mirror these data
at Fermi.

<P>
At Princeton, the top-level directory for the reduced data is:
<DL><DD><PRE>
/u/dss/spectro
</PRE></DD></DL>
Older reductions exist at:
<DL><DD><PRE>
/u/dss/spectro_v4
</PRE></DD></DL>

<!--
<P>
Note that we have not been able to copy all these data to the Fermi machines.
Some fraction of these data are available at the following sites:
<DL><DD><PRE>
sdssdp3.fnal.gov:/data/dp3.p/data/schlegel/2d_v4_7 (some new reductions)
fsgi03.fnal.gov:/usr/sdss/data04/schlegel/2d_v4 (old reductions)
</PRE></DD></DL>
-->

<P>
To obtain the data from Princeton you will need access to the "alfred"
account.  Send your SSH public key (in the file ".ssh/identity.pub") to
<A HREF="mailto:schlegel@astro.princeton.edu">schlegel@astro.princeton.edu</A>.
Once you have been added to the authorized_keys list for user "alfred",
then you can copy all 160 Gb of outputs (as of Feb 2002) with:
<DL><DD><PRE>
   rsync -arv --rsh="ssh" \
    alfred@sdssdata.princeton.edu:/u/dss/spectro/ .
</PRE></DD></DL>
Most people will only want the summary files, combined spectra, 1D outputs,
and log files (about 35 Gb as of Feb 2002):
<DL><DD><PRE>
   rsync -arv --rsh="ssh" --include "*/" \
    --include "platelist*" --include "spAll*" \ 
    --include "*spZ*.fits" --include "spPlate*.fits" \ 
    --include "*.log" --include "*.ps" \
    --exclude "*"  \
    alfred@sdssdata.princeton.edu:/u/dss/spectro/ .
</PRE></DD></DL>
</B>

<P>
Each plate has the following files associated with it:
<DL><DD><PRE>
$SPECTRO_DATA/$PLATE/spPlate-$PLATE-$MJD.fits
$SPECTRO_DATA/$PLATE/spZbest-$PLATE-$MJD.fits
$SPECTRO_DATA/$PLATE/spZline-$PLATE-$MJD.fits
$SPECTRO_DATA/$PLATE/spZall-$PLATE-$MJD.fits
</PRE></DD></DL>
where $SPECTRO_DATA refers to the top-level directory (spectro), and $PLATE
refers to a subdirectory with the plate name (e.g., 0301), and $MJD refers
to the date of observation (e.g., 52000).

<H4><A NAME="get_rsync">How to Keep Your Data Up-to-Date</A></H4>

<P>
These spectroscopic reductions are completely automated with the
Spectro Robot.  As data are taken at Apache Point, the data are copied
to Princeton, plan files are built that describe how to reduce the
data, and the reductions are batched on local and remote CPU's.
<!--
Once each day, these reduced data are synced with a Fermi mirror site.
-->
You can expect all spectroscopic observations to be reduced within 24 hours.

<P>
An efficient way to keep your copy of these reductions current is to use
the Unix "rsync" command:
<DL><DD><PRE>
rsync -arv --rsh="ssh" alfred@sdssdata.princeton.edu:/u/dss/spectro/ .
</PRE></DD></DL>
You can use this to copy the data to your own computer in the first place.
If you run "rsync" again, it will copy any files that have been
changed or added.  Note that you need "ssh" to work without asking for a
pass-phrase for "rsync" to work as a cron job (see below) -- see your system
admin if you need help with that.

<P>
Finally, you could set up a "cron" job to update your copy of the data on
a daily basis.  This would be done by creating a cron table file (call it
"cron.table" in this example).  If you want to copy all 160 Gb of spectro
outputs, this file would look like:
<DL><DD><PRE>
15 3 * * * /usr/bin/rsync -arv --rsh="ssh" alfred@sdssdata.princeton.edu:/u/dss/spectro/ /my/directory
</PRE></DD></DL>
replacing "/my/directory" with your local data-directory name.
Most people will want only the following files (35 Gb of data):
<DL><DD><PRE>
15 3 * * * /usr/bin/rsync -arv --rsh="ssh" --include "*/" --include "platelist*" --include "spAll*" --include "*spZ*.fits" --include "spPlate*.fits" --include "*.log" --include "*.ps" --exclude "*" alfred@sdssdata.princeton.edu:/u/dss/spectro/ /my/directory
</PRE></DD></DL>
Finally, you may simply want the summary files:
<DL><DD><PRE>
15 3 * * * /usr/bin/rsync -arv --rsh="ssh" --include "platelist*" --include "spAll*" --exclude "*" alfred@sdssdata.princeton.edu:/u/dss/spectro/ /my/directory
</PRE></DD></DL>
Then load this "cron" job by typing:
<DL><DD><PRE>
crontab cron.table
</PRE></DD></DL>
This example will update your copy of the data at 3:15am every morning.
To stop this updating, unload the cron table with:
<DL><DD><PRE>
crontab -r
</PRE></DD></DL>

<H2><A NAME="special">"Special" Plates</A></H2>

<P>There are a number of "special" plates, designed for commissioning
either the hardware or target selection for the survey.  These plates are:
<UL>
<LI> <B>Plate 125-134, 160, 161 : Coma plates </B><BR>
     See
     <A HREF="http://ranger.phys.cmu.edu/users/merrelli/">
     Aaron Merrelli's web page</A>.<BR>
     These data were taken when the spectrographs were just being put
     together.  Only one spectrograph was on the telescope (with 320 fibers),
     and there was significant light contamination from LED's inside the
     instrument.<BR>
     Plate 133 was observed.
<LI> <B>Plate 135-159 : Early data plates </B><BR>
     These plates have the same caveats as for the Coma plate above.
     Descriptions of these early data and how to obtain raw and reduced
     spectra, can be found at:<BR>
<A HREF="http://www-sdss.fnal.gov:8000/spectrodoc/doc/www/spectra/list.html">
     http://www-sdss.fnal.gov:8000/spectrodoc/doc/www/spectra/list.html</A>
<LI> <B>Plates 162-185 : FASST plates </B><BR>
     These are test plates with astrometric stars.  Only engineering data
     was taken with these plates.
<LI> <B>Plates 229-231 : Reddening plate </B><BR>
     Plate 231 was observed in marginal conditions on MJD 51455+51456, and
     again on MJD 52221.  Plate 230 was observed on MJD 52251.
<LI> <B>Plates 318,319 : Faint M67 plates </B><BR>
     These plates were designed by Brian Yanny (318) and David Schlegel (319).
     See
     <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/msg.149.html">
     sdss-spcommish msg/149</A>
     and
     <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/msg.159.html">
     sdss-spcommish msg/159</A>.<BR>
     Plate 318 was observed on several occasions; plate 319 was never observed.
     Since the SPECTROPHOTO standards were really just random positions on
     the sky, the current reductions are probably garbage.
<LI> <B>Plate 320 : Faint QSO plate </B><BR>
     See
     <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/msg.206.html">
     sdss-spcommish msg/206</A> <BR>
     This plate has not been observed.
<LI> <B>Plate 321 : M67 velocity standards</B><BR>
     See
     <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/msg.206.html">
     sdss-spcommish msg/206</A> <BR>
     This plate was observed and used to test the precision of measuring
     velocities.
<LI> <B>Plates 322-324 : Stellar locus plates</B><BR>
     See
     <A HREF="http://www.astro.princeton.edu:81/sdss-spcommish/msg.206.html">
     sdss-spcommish msg/206</A> <BR>
     The two fainter plates, 323 and 324, have been observed.
<LI> <B>Plates 669-672 : Photo-z plates</B><BR>
     These are designed to target high-redshift, non-red galaxies.
     See <A HREF="http://tarkus.pha.jhu.edu/~csabai/hidden/south/">
     Istvan Csabai's web site</A>. <BR>
<LI> <B>Plates 673-714, 716-726 : Southern Survey plates</B><BR>
     See the <A HREF="http://www.astro.princeton.edu:81/sdss-southern/INDEX.html">
     Southern Survey mailing list</A>.  All primary targets (non-sky, non-standard,
     etc.) have 0-indexed bit #31 set in their
     <A HREF="#targetflags">PRIMTARGET target flag</A>.
<LI> <B>Plate 715 : Bright Stars test plate</B><BR>
<LI> <B>Plate 797 : Faint F subdwarf plate</B><BR>
     This was designed by Brian Yanny from the imaging runs 125 and 752,
     and selects F stars in the magnitude range g=[19,20.5] at RA=4.5 hrs.
<LI> <B>Plates 798-801 : Star cluster plates</B><BR>
     See the <A HREF="http://www.astro.princeton.edu:81/sdss-spectro/msg.766.html">sdss-spectro/766</A>.
     The clusters are Praesepe (798), Pleiades (799), N752 (800), N1817 (801).
     These plates have several tiles (pointings per plate), and require
     special instructions for observing.
<LI> <B>Plates 802-806 : Galaxy cluster plates?</B><BR>
     These plates were designed by Jim Annis.
<LI> <B>Plates 807-810 : Szalay photo-z plates</B><BR>
     These plates were designed by Alex Szalay.
<LI> <B>Plate 811 : Loveday photo-z plate</B><BR>
     This plate was designed by Jon Loveday.
</UL>

<H2><A NAME="summary">What Is the Summary File?</A></H2>

<P>
We generated one monstrous file with all the spectroscopic
and photometric outputs (but not the actual images, spectra
or spectroscopic line fits).
This is a FITS binary table called "spAll.fits".
At present, there are two versions of this file as follows:
<OL>
   <LI><B>spAll.fits</B> - All spectroscopic data taken to date
       from 'marginal' or 'good' plates
       (see PLATEQUALITY in the <A HREF="#platelist">platelist file</A>)
   <LI><B>spAll-public.fits</B> - spAll trimmed to only those plates
       that should be in the Early Data Release (EDR) or Data Release 1 (DR1)
</OL>

<P>
The following information is compiled for each object:
<TABLE BORDER=1 CELLPADDING=3>
 <TR><TD> PROGNAME     <TD> Spectroscopic program: 'main' for the SDSS main survey,
                            'southern' for the SDSS Southern survey, and
                            'devel', 'special', 'photoz' for other assorted programs
 <TR><TD> CHUNKNAME    <TD> Targetting chunk name (this is a numeric value for
                            all plates in the 'main' or 'southern' survey)
 <TR><TD> PLATEQUALITY <TD> Quality of plate from platelist file: 'bad', 'marginal', or 'good'
 <TR><TD> PLATESN2     <TD> Signal-of-noise measure of the plate
 <TR><TD> SMEARUSE     <TD> 'T' if a smear is used for spectrophotometry; 'F' otherwise
 <TR><TD> SPECPRIMARY  <TD> 1 for the best spectroscopic observation of each object
 <TR><TD> ZANS         <TD> ZANS structure from <A HREF="#dm_spzbest">spZbest</A> file
                            with spectroscopic classifications, redshifts, etc.
 <TR><TD> TSOBJ        <TD> TSOBJ structure with all imaging and target-selection paramters
                            (excluding the FIRST and ROSAT fields)
</TABLE>

<P>
In addition, we've also made ASCII files with the most relevant quantities
that one may wish to search on.  This file is "spAll*.dat", and is basically
a stripped-down version of "spAll*.fits" for those FITS-challenged astronomers.

<P>
These photometric outputs were assembled by Daniel Eisenstein and Mike Blanton.
Where the PHOTO data does exist, they are selected from the tsObj files
used to drill the plates, <B>not necessarily the most recent calibrations</B>.
This is what Eisenstein & Blanton call their "skyVersion==0" outputs.

<P>
Note that some of the photometric outputs were never recovered!
Of 226,560 reduced spectra, we are missing PHOTO data for 8581 spectra.
Since plate 324, we are missing PHOTO data for 110 of 169,600 spectra.
We are missing no PHOTO data for spectra in the Early Data Release.

<P>
If you have access to the Princeton computers,
these trimmed tsObj files can be found at:
<PRE>
  sdssdata.princeton.edu:/u/dss/spectro/plates
</PRE>

<P>
Another technical point: the <A HREF="#targetflags">target flags</A>
have been over-written with those found in the plPlugMapM files,
since Eisenstein reports that they are incorrect in many of the tsObj files.
Also, the distance between the spectroscopic target and the matched PHOTO
output is stuffed into the TEXTURE[0] column.

<H2><A NAME="display">Looking at the Data</A></H2>

<P>
Since standard FITS files are used, there are many ways to access these
data.  Below are descriptions of specially-written IDL, SM, and IRAF code for
looking at the data.
If you write any such tools, it would be useful to make them available
to the collaboration by posting them on this site.

<P>
The absolute simplest way to look at the data is to use ATV, SAOimage or XIMTOOL
to display the plate images (spPlate*.fits), which will show you all 640
spectra on a plate at once.

<H4><A NAME="idlsetup">Setting Up IDL Tools</A></H4>

<P>
You must have "idl" in your path, and the IDL_PATH
environment variable should already be set.  At Princeton, you would type
the following for C-shell:
<DL><DD><PRE>
  source /usr/peyton/common/licensed/idl/bin/idl_setup
</PRE></DD></DL>
or the following for Bourne shell:
<DL><DD><PRE>
  IDL_DIR=/usr/peyton/common/licensed/idl
  IDL_PATH=.:+{$IDL_DIR}/lib
  alias idl=$IDL_DIR/bin/idl
</PRE></DD></DL>

<P>
If you have someone maintaining survey code at your institution
(i.e., at Princeton using a Linux box), you can set up the tools
by simply typing:
<DL><DD><PRE>
  source /u/products/etc/sdssfue.csh  # If you are using C-shell
  source /u/products/etc/sdssfue.sh   # If you are using Bourne-shell
  setup idlspec2d
</PRE></DD></DL>

<P>
If you need to install the code yourself, you need two products:
"idlutils", and "idlspec2d".  If you wish to reduce the raw data
from scratch, you will also need a third product called "specflat".
See the instructions for installing this code at:
<DL><DD><PRE>
  <A HREF="http://spectro.princeton.edu/idlspec2d_install.html">http://spectro.princeton.edu/idlspec2d_install.html</A>
</PRE></DD></DL>
Included are the instructions for <A HREF="http://spectro.princeton.edu/idlspec2d_install.html#install_tar">installing from a tar file</A>.
The tar files are available at:
  <A HREF="http://spectro.princeton.edu/tarballs">http://spectro.princeton.edu/tarballs</A>.
The code will work on any platform (Linux, SGI, Solaris, etc) as long as
you also have an IDL license.

<P>
Extensive documentation exists for the commands described below, in
the file:
<DL><DD><PRE>
<A HREF="idlspec2d_doc.html">$IDLSPEC2D_DIR/doc/www/idlspec2d_doc.html</A>
</PRE></DD></DL>

<H4><A NAME="idldisplay">Displaying the Spectra From IDL</A></H4>

<P>
First, set up the "idlutils" and "idlspec2d" software, as described above.

<P>
You need to set an environment variable that points to the top-level
directory of the data.  At Princeton, this would be:
<DL><DD><PRE>
setenv SPECTRO_DATA /u/dss/spectro
</PRE></DD></DL>

<P>
Start IDL with:
<DL><DD><PRE>
idl
</PRE></DD></DL>

<P>
Then from within IDL, you can display individual spectra as following.
To display plate 401, fiber 100:
<DL><DD><PRE>
IDL> <A HREF="idlspec2d_doc.html#PLOTSPEC">plotspec</A>, 401, 100
</PRE></DD></DL>
The spectrum is shown in white, the errors in red (except masked points
are set to zero), and the best-fit eigenspectrum in blue.
The mouse buttons will zoom in (left), recenter (center), or zoom out (right).
The frame can be saved as a PostScript file by selecting File->WriteEPS
from the left-hand corner.

<P>
Make the same plot, but boxcar-smooth the spectrum:
<DL><DD><PRE>
IDL> <A HREF="idlspec2d_doc.html#PLOTSPEC">plotspec</A>, 401, 100, nsmooth=10
</PRE></DD></DL>

<P>
Some plates are observed on multiple nights.  To select one of the two
observations of plate 306:
<DL><DD><PRE>
IDL> <A HREF="idlspec2d_doc.html#PLOTSPEC">plotspec</A>, 306, 20, mjd=51690
</PRE></DD></DL>

<P>
You can write the spectrum to an ASCII file as follows:
<DL><DD><PRE>
IDL> <A HREF="idlspec2d_doc.html#WRITESPEC">writespec</A>, 401, 100
</PRE></DD></DL>
The default file name will be "spec-0401-51788-100.dat".  This can
be changed by setting the FILENAME keyword:
<DL><DD><PRE>
IDL> <A HREF="idlspec2d_doc.html#WRITESPEC">writespec</A>, 401, 100, filename='junk.dat'
</PRE></DD></DL>

<P>
Quitting IDL:
<DL><DD><PRE>
IDL> exit
</PRE></DD></DL>

<P>
<B>For IDL pundits</B>, the general-purpose routine for reading the data
is the <A HREF="idlspec2d_doc.html#READSPEC">READSPEC</A> procedure.

<H4><A NAME="smdisplay">Displaying the Spectra From SM</A></H4>

<P>
The SM tools were written by Michael Strauss, Vijay Narayanan, and Robert
Lupton.
<UL>
<LI> <A HREF="spectro_sm/README.spectro">Click here for their README file.</A>
<LI> <A HREF="spectro_sm.tar">Click here for their tar file.</A>
</UL>
Problems and suggestions should be reported to Michael Strauss
(<A HREF="mailto:strauss@astro.princeton.edu">strauss@astro.princeton.edu</A>).

<P>
You will need the latest version of SM (version SM2_4_8), which supports
FITS extensions.  If you have a valid SM license, you or your system admin
should be able to install this (see the bottom of
Michael's <A HREF="spectro_sm/README.spectro">README file</A>.
At Princeton, the new version is available on either "tanuki" or "moonshine"
by executing:
<DL><DD><PRE>
~rhl/sm/src/sm
</PRE></DD></DL>

<P>
At Princeton, you could type the following to display plate 306 fiber 100,
then overplot the best-fit template:
<DL><DD><PRE>
ssh moonshine
setenv SPECTRO_DATA /u/dss/spectro
setenv IDLSPEC2D_DIR /u/schlegel/idlspec2d
cd ~strauss/spectro_sm/release
~rhl/sm/src/sm
dev x11
input_new spectro.sm
define idl 1
plotspec 306 100
   t
</PRE></DD></DL>

<H4><A NAME="irafdisplay">Displaying the Spectra From IRAF</A></H4>

<P>
Described below is the most basic method of plotting the spectra from IRAF.
Better tools will be posted on this page as they are available.

<P>
Use the splot task in the noao.onedspec package.  For example:

<PRE>
cl> noao
no> onedspec
on> splot spPlate-0311-51665.fits[0][*,1]   # plot fiber 1's flux
on> splot spPlate-0311-51665.fits[1][*,1]   # plot fiber 1's inverse variance **
on> splot spPlate-0311-51665.fits[0]        # interactively plot fluxes:
Image line/aperture to plot (0:) (1): 65    # start w/fiber 65; use # to choose
        # a new fiber, or ( and ) to move down and up by 1 in number; q to quit
on> phelp splot                             # for detailed help on splot
on> phelp onedspec                          # for summary of other tasks, e.g.:
on> specplot spPlate-0311-51665.fits[0][*,1],spPlate-0311-51665.fits[0][*,2]
        # stack and plot fibers 1 and 2 without overlapping
</PRE>

<H4><A NAME="irafphist">Pat Hall's IRAF SDSS Tasks</A></H4>

<P>
Pat Hall has written an IRAF package, PHIST, for displaying SDSS spectra.
It does not have all the functionality of the IDL tools, but does have
some complementary functions.  The task list is as follows:
<PRE>
 dec2seg - convert decimal coordinates to sexigesimal
   doigi - run existing IGI script
hexprint - convert a decimal number to hexadecimal
  ionlte - calculate LTE ratios of MgI-III,AlI-IV,FeI-IV for given n_e,T ranges
  lplots - overplot wavelengths of emission / absorption lines for given z
 lplots2 - 2-panel lplots
mkfitsobs - make coadded FITS and text spectrum
   mkobs - make text spectrum from FITS spectrum
   sbqgr - sample task for converting GR's SX .tbl output to formatted ASCII
   sbqsx - sample task for converting SX .tbl output to formatted ASCII
  sbqsx2 - another task for converting SX .tbl output to formatted ASCII
 seg2dec - convert sexigesimal coordinates to decimal
  spdata - get objid,mags,ra,dec,objtype from spectrum (plate,mjd,fiber)
   splat - interactively SPLOT a specific observation (plate+mjd+fiber) 
   splet - non-interactively SPECPLOT an observation and its error spectrum 
unredden - deredden spectrum using SMC or LMC extinction curve
   vcalc - calculate velocity offset in quasar rest frame
   vplot - overplot wavelengths of emission / absorption lines in velocity space
  vplots - multiple vplot
   wcalc - calculate vacuum wavelength from air wavelength
   zplot - plot spectrum in the rest frame at the specified z
</PRE>

Here's the README file on how to retrieve & install the package
for version v.2 (December 2001):

<PRE>
        PHIST -- Pat Hall's IRAF SDSS Tasks

v.2     011207  Read "phist.hlp" ("phelp phist opt=sys" in IRAF) for an
        introduction.  Entire package available as a compressed tarfile
        from <A HREF="http://astro.princeton.edu/~pathall/phist2.tar.gz">http://astro.princeton.edu/~pathall/phist2.tar.gz</A>
        To install, enter the proper pathnames in "phist.cl" and
        "phist.hd", load the IRAF "softools" package, and type
        "mkhelpdb root.hd helpdb.mip", deleting the old helpdb.mip
        if necessary.  See "phist.hlp" for how to include
        the package in your default IRAF startup.
</PRE>

<H2><A NAME="datamodel">What Is the Data Model?</A></H2>

Intermediate outputs:
<UL>
<LI><A HREF="#dm_spframe">spFrame-<I>cc</I>-<I>eeeeeeee</I>.fits</A>
<LI><A HREF="#dm_spdiag2dlog">spDiag2d-<I>pppp</I>-<I>mmmmm</I>.log</A>
<LI><A HREF="#dm_spdiag2dps">spDiag2d-<I>pppp</I>-<I>mmmmm</I>.ps</A>
</UL>

Final spectra:
<UL>
<LI><A HREF="#dm_spplate">spPlate-<I>pppp</I>-<I>mmmmm</I>.fits</A>
<LI><A HREF="#dm_spdiagcomblog">spDiagcomb-<I>pppp</I>-<I>mmmmm</I>.log</A>
<LI><A HREF="#dm_spdiagcombps">spDiagcomb-<I>pppp</I>-<I>mmmmm</I>.ps</A>
</UL>

Spectroscopic classifications, redshifts, and line fitting:
<UL>
<LI><A HREF="#dm_spzbest">spZbest-<I>pppp</I>-<I>mmmmm</I>.fits</A>
<LI><A HREF="#dm_spzline">spZline-<I>pppp</I>-<I>mmmmm</I>.fits</A>
<LI><A HREF="#dm_spzall">spZall-<I>pppp</I>-<I>mmmmm</I>.fits</A>
<LI><A HREF="#dm_spdiag1dlog">spDiag1d-<I>pppp</I>-<I>mmmmm</I>.log</A>
<LI><A HREF="#dm_spdiag1dps">spDiag1d-<I>pppp</I>-<I>mmmmm</I>.ps</A>
</UL>

<H4><A NAME="dm_spplate">spPlate-<I>pppp</I>-<I>mmmmm</I>.fits</H4>

<P>
This file contains the combined spectra for all exposures
(potentially spanning multiple nights) for a given mapped plate.
The first 5 HDU's contain NPIX by 640 images, where NPIX is the
number of wavelengths.

<P>
The spPlate file contains the following:<BR>
<PRE>
HDU #0 = Flux in units of 10^(-17) erg/cm/s/Ang [FLOAT]
HDU #1 = Inverse variance (1/sigma^2) for the above [FLOAT]
HDU #2 = AND mask [32-bit INT]
HDU #3 = OR mask [32-fit INT]
HDU #4 = Wavelength dispersion in pixels [FLOAT]
HDU #5 = Plug-map structure from plPlugMapM file [BINARY FITS TABLE]
</PRE>

<P>
The following header keywords are of interest (in HDU #0): <BR>
<PRE>
PLATEID = Plate ID
TILEID  = Tile ID
MJD     = Modified Julian date for first night of observation
MJDLIST = Modified Julian date for all nights of observation
MAPID   = Fiber mapper ID
CARTID  = Fiber cartridge used at the telescope
NAME    = Name of target: Plate ID, MJD, Fiber mapper rerun
COEFF0  = Central wavelength (log10-Angstroms) of first pixel
COEFF1  = Wavelength range of each pixel (log-10 Angstroms)
CRVAL1  = (Same as COEFF0)
CD1_1   = (Same as COEFF1)
RADEG   = Right ascension of plate center (J2000 degrees)
DECDEG  = Declination of plate center (J2000 degrees)
AIRMASS = Airmass for mid-point of observation
RA      = Right ascension of where the telescope thinks it is pointing
DEC     = Declination of where the telescope thinks it is pointing
AZ      = Azimuth of the telescope (degrees)
ALT     = Altitude of the telescope (degrees)
NEXP    = Total number of frames from all cameras used in the co-adding;
          since there are 4 cameras, NEXP=12 would typically mean that there
          were 3 exposures in each camera.
EXPT_B1 = b1 camera exposure time (seconds)
EXPT_B2 = b2 camera exposure time (seconds)
EXPT_R1 = r1 camera exposure time (seconds)
EXPT_R2 = r2 camera exposure time (seconds)
EXPTIME = Minimum of exposure times for all cameras
SMEARUSE= Set to 'T' if the spectra were normalized to a smear exposure,
          which is effectively a 1-minute exposure on a 5 x 7 arcsec
          aperature.
SPEC1_G = (S/N)^2 per pixel at g=20.2 on spectrograph #1.
SPEC2_G = (S/N)^2 per pixel at g=20.2 on spectrograph #2.
SPEC1_R = (S/N)^2 per pixel at r=20.25 on spectrograph #1.
SPEC2_R = (S/N)^2 per pixel at r=20.25 on spectrograph #2.
SPEC1_I = (S/N)^2 per pixel at i=19.9 on spectrograph #1.
SPEC2_I = (S/N)^2 per pixel at i=19.9 on spectrograph #2.
TAI     = Number of seconds since Nov 17 1858 for mid-point of observation
TAI-BEG = Number of seconds since Nov 17 1858 for beginning of observation
TAI-END = Number of seconds since Nov 17 1858 for end of observation
SEEING20= 20th-percentile of seeing during exposure (arcsec)
SEEING50= 50th-percentile of seeing during exposure (arcsec)
SEEING80= 20th-percentile of seeing during exposure (arcsec)
RMSOFF20= 20th-percentile of RMS offset of guide fibers (arcsec)
RMSOFF50= 20th-percentile of RMS offset of guide fibers (arcsec)
RMSOFF80= 20th-percentile of RMS offset of guide fibers (arcsec)
VERSIDL = Version of IDL
VERS2D  = Version of idlspec2d for 2D reduction
VERSCOMB= Version of idlspec2d for combining multiple spectra
VERSFLAT= Version of specflat for spectroscopic flat-fields
VERS1D  = Version of idlspec2d for 1D reduction
HELIO_RV= Barycentric velocity correction (km/sec)
</PRE>

<P>
There are two masks, an "AND" mask and an "OR" mask.  The spectra
are constructed from 3 or more 15-minute observations, and the "AND" mask
bits are set if that bit is set for each and every input observation.
The "OR" mask bits are set if that bit is set for any of the observations.
Usually, I only look at the "AND" mask.

<P>
The mask bits are set as follows: <BR>
<PRE>
 0 NOPLUG          Fiber not listed in plugmap file
 1 BADTRACE        Bad trace from routine TRACE320CRUDE
 2 BADFLAT         Low counts in fiberflat
 3 BADARC          Bad arc solution
 4 MANYBADCOLUMNS  >10% pixels are bad columns
 5 MANYREJECTED    >10% pixels are rejected in extraction
 6 LARGESHIFT      Large spatial shift between flat and object pos'n
 7 BADSKYFIBER     Sky Fiber shows extreme residuals
 8 NEARWHOPPER     Within 2 fibers of a whopping fiber (inclusive)
10 SMEARIMAGE      Smear available for red and blue cameras
11 SMEARHIGHSN     S/N sufficient for full smear fit
12 SMEARMEDSN      S/N only sufficient for scaled median fit
16 NEARBADPIXEL    Bad pixel within 3 pixels of trace
17 LOWFLAT         Flat field less than 0.5
18 FULLREJECT      Pixel fully rejected in extraction (INVVAR=0)
19 PARTIALREJECT   Some pixels rejected in extraction
20 SCATTEREDLIGHT  Scattered light significant
21 CROSSTALK       Cross-talk significant
22 NOSKY           Sky level unknown at this wavelength (INVVAR=0)
23 BRIGHTSKY       Sky level > flux + 10*(flux error)
                   AND sky > 2.0 * median(sky,99 pixels)
24 NODATA          No data available in combine B-spline (INVVAR=0)
25 COMBINEREJ      Rejected in combine B-spline
26 BADFLUXFACTOR   Low flux-calibration or flux-correction factor
27 BADSKYCHI       Relative chi^2 > 3 in sky residuals at this wavelength
28 REDMONSTER      Contiguous region of bad chi^2 in sky residuals
                   (with threshhold of relative chi^2 > 3)
</PRE>

<P>
When low numbered bits (<16) are set, those will be set for half
of the spectra -- either the blue or red spectrograph.  The higher-numbered
bits (>=16) are set for individual pixels.

<P>
<B>Which mask bits are important?</B>  The conditions that are considered
very bad are already used to set the errors to infinity for the
effected pixels (specifically, the inverse variance is set to zero).
The most useful mask bit to look at is BRIGHTSKY, which indicates
when the sky is so bright relative to the object that perhaps one
shouldn't trust any of the object flux there.  Our reported errors
are meant to include sky-subtraction errors, but there are instances
(particularly around 5577) where these errors may be untrustworthy.

<H4><A NAME="dm_spzbest">spZbest-<I>pppp</I>-<I>mmmmm</I>.fits</H4>

<P>
This file contains the spectroscopic classifications and redshifts
from the Princeton-1D code.
Ths first HDU is the FITS binary table described below.
The 2nd HDU is the best-fit eigen-spectrum for each object.
These can be regenerated from the tabular information, but for
convenience I've explicitly computed them.

<P>
The columns in the first HDU are as follows: <BR>
<PRE>
PLATE      Plate number
TILE       Tile number
MJD        Modified Julian date of observation
FIBERID    Fiber ID (1 to 640)
OBJID      4-element PHOTO ID of targetted object: run, re-run, column, ID
OBJTYPE    Why this object was targetted.  Note that if this field says QSO,
           it could be the case that this object would have been targetted
           as a GALAXY or any number of other categories as well.  The
           PRIMTARGET and SECTARGET flags in the plug-map structure (in the
           spPlate file) gives this full information.
PLUG_RA    Object RA (drilled fiber position)
PLUG_DEC   Object DEC (drilled fiber position)
CLASS      Spectro classification: GALAXY, QSO, STAR; reductions prior to
           version v4_7 will also use SKY and UNKNOWN; later versions set
           the ZWARNING flags
SUBCLASS   Spectro sub-classification.  Galaxies and QSO's can be given
             sub-classificatoins based upon their emission lines.
             This text includes the word "AGN" if:
               log10(OIII/Hbeta) > 0.7 - 1.2 * (log10(NII/Halpha) - 0.4)
             This text includes the word "STARFORMING" if:
               log10(OIII/Hbeta) < 0.7 - 1.2 * (log10(NII/Halpha) - 0.4)
             If the H_alpha E.W. > 500 Ang, then upgrade "STARFORMING" to
             "STARBURST."
             In all cases for AGN, STARFORMING, and STARBURST, the 4 emission
             lines used for that sub-classification must have well-measured
             errors (e.g., LINEAREA_ERR > 0).
             If any galaxies or quasars have lines detected at the 10-sigma
             level with sigmas > 200 km/sec at the 5-sigma level, call them
             "BROADLINE".
           For stars, the following subclassifications are in use:
             O, OB, B6, B9, A0, A0p, F2, F5, F9, G0, G2, G5, K1, K3, K5, K7,
             M0V, M2V,M1, M2, M3, M4, M5, M6, M7, M8, L0, L1, L2, L3, L4, L5,
             L5.5, L9, T2, Carbon, Carbon_lines, Carbon_DQ, Carbon_DQred, CV.
Z          Redshift; if the ZWARNING flag is nonzero, then assume that this
           redshift is incorrect
Z_ERR      Redshift error based upon fit to chi^2 minimum; negative for
           invalid fit
RCHI2      Reduced chi^2 for best fit
DOF        Degrees of freedom for best fit
RCHI2DIFF  Difference in reduced chi^2 of best solution to 2nd best solution
TFILE      Template file in $IDLSPEC2D_DIR/templates
TCOLUMN    Columns to use in template file (0-indexed); unused values set to -1
NPOLY      Number of polynomial terms used in conjuction with TFILE
THETA      Eigenvalue coefficients for each column in template file + each polynomial term
VDISP      Velocity dispersion, only computed for galaxies (km/sec)
VDISP_ERR  Error in VDISP (km/sec); negative for invalid fit
WAVEMIN    Minimum observed (vacuum) wavelength for this object (Angstroms)
WAVEMAX    Maximum observed (vacuum) wavelength for this object (Angstroms)
WCOVERAGE  Amount of wavelength coverage in log-10(Angstroms)
ZWARNING   A flag set for bad redshift fits in place of calling CLASS=UNKNOWN.
           The following bits may be set:
           0 = Sky fiber
           1 = Too little wavelength coverage (WCOVERAGE < 0.18)
           2 = Chi^2 is too close to chi^2 for the next best fit (within 0.01)
           3 = Synthetic spectrum is negative (only set for stars and QSO's)
           4 = Fraction of points above 5 sigma is too large (> 5%)
           5 = Chi^2 minimum was at the edge of the redshift-fitting range,
               resulting in Z_ERR being set to -1
SN_MEDIAN  Median S/N for all good pixels
CHI68P     68-th percentile value of abs(chi) of the best-fit synthetic
           spectrum to the actual spectrum, which would be 1.0 for a good fit
           if the errors are properly normalized.
FRACNSIGMA Fraction of pixels deviant by more than N sigma, where N=[1,2,...10]
FRACNSIGHI Fraction of pixels high by more than N sigma, where N=[1,2,...10]
FRACNSIGLO Fraction of pixels low by more than N sigma, where N=[1,2,...10]
           (incorrectly computed for versions of the code before v4_9_10)
COUNTS_SPECTRO  5-element array of total flux in each of the 5 PHOTO filters;
                the units are such that this equals 1 at 0th magnitude;
                convert to magnitudes with -2.5 * LOG_10(COUNTS_SPECTRO);
                the u-band and z-band counts should not be used
COUNTS_SYNTH    Same as COUNTS_SPECTRO, but measured using the best-fit
                synthetic eigen-spectrum rather than the actual data points
COUNTS_SKY      (Placeholder.)
ANYANDMASK Mask bits which are set if any pixels for an object's ANDMASK
           have that bit set (these fields incorrect in current reductions)
ANYORMASK  Mask bits which are set if any pixels for an object's ORMASK
           have that bit set (these fields incorrect in current reductions)
SPEC1_G    (S/N)^2 at g=20.20 for spectrograph #1 (same value for 320 fibers)
SPEC1_R    (S/N)^2 at r=20.25 for spectrograph #1 (same value for 320 fibers)
SPEC1_I    (S/N)^2 at i=19.90 for spectrograph #1 (same value for 320 fibers)
SPEC2_G    (S/N)^2 at g=20.20 for spectrograph #2 (same value for 320 fibers)
SPEC2_R    (S/N)^2 at r=20.25 for spectrograph #2 (same value for 320 fibers)
SPEC2_I    (S/N)^2 at i=19.90 for spectrograph #2 (same value for 320 fibers)
ELODIE_FILENAME   File name for best-fit Elodie star
ELODIE_OBJECT     Star name (mostly Henry Draper names)
ELODIE_SPTYPE     Spectral type
ELODIE_BV         (B-V) color
ELODIE_TEFF       Effective temperature
ELODIE_LOGG       Log10(gravity)
ELODIE_FEH        [Fe/H]
ELODIE_Z          Redshift
ELODIE_Z_ERR      Redshift error; negative for invalid fit
ELODIE_Z_MODELERR The standard deviation in redshift amongst the 12
                  best-fit stars
ELODIE_RCHI2      Reduced chi^2
ELODIE_DOF        Degrees of freedom for fit
</PRE>

<H4><A NAME="dm_spzline">spZline-<I>pppp</I>-<I>mmmmm</I>.fits</H4>

<P>
This file contains the line fits from from the Princeton-1D code.

<P>
The columns in the first HDU are as follows: <BR>
<PRE>
PLATE      Plate number
MJD        Modified Julian date of observation
FIBERID    Fiber ID (1 to 640)
LINENAME   Line name
LINEWAVE   Catalog wavelength for this line in vacuum Angstroms
LINEZ          Redshift
LINEZ_ERR      Redshift error (negative for invalid fit)
LINESIGMA      Gaussian width in km/sec
LINESIGMA_ERR  Error in gaussian width (negative for invalid fit)
LINEAREA       Area in gaussian fit where units are (flux-units) * Ang
LINEAREA_ERR   Flux error (negative for invalid fit)
LINEEW         Equivalent width
LINEEW_ERR     Equivalent width error (negative for invalid fit)
LINECONTLEVEL      Continuum level at line center
LINECONTLEVEL_ERR  Error in continuum level at line center
LINENPIX           Number of good pixels within +/- 3 sigma of the line center
LINEDOF            Degrees of freedom in fit, approximated as LINENPIX minus
                   the number of terms fit for that line, which can be
                   fractional if one parameter if fixed betwen several lines
LINECHI2           Chi^2 for all points within +/- 3 sigma of the line center
                   (negative if no such points)
</PRE>

<P>
The following lines are fit.  Lines with the same ZINDEX are constrained to
have the same redshift.  Lines with the same WINDEX are constrained to have
the same gaussian width.  The flux ratios of [O_III] and [N_II] are are
constrained to be 1:3.
<TABLE BORDER=1 CELLPADDING=3>
 <TR><TH> LINEWAVE  <TH> LINENAME    <TH> ZINDEX    <TH> WINDEX     <TH> Flux ratio
 <TR><TD> 1215.67   <TD> Ly_alpha    <TD> z_lya     <TD> w_ly_a     <TD>
 <TR><TD> 1240.81   <TD> N_V 1240    <TD> zemission <TD> w_n_v      <TD>
 <TR><TD> 1549.48   <TD> C_IV 1549   <TD> zemission <TD> wemission  <TD>
 <TR><TD> 1640.42   <TD> He_II 1640  <TD> zemission <TD> wemission  <TD>
 <TR><TD> 1908.734  <TD> C_III] 1908 <TD> zemission <TD> wemission  <TD>
 <TR><TD> 2799.49   <TD> Mg_II 2799  <TD> zemission <TD> wemission  <TD>
 <TR><TD> 3725.94   <TD> [O_II] 3725 <TD> zemission <TD> wemission  <TD>
 <TR><TD> 3727.24   <TD> [O_II] 3727 <TD> zemission <TD> wemission  <TD>
 <TR><TD> 4101.734  <TD> H_delta     <TD> zemission <TD> w_balmer   <TD>
 <TR><TD> 4340.464  <TD> H_gamma     <TD> zemission <TD> wemission  <TD>
 <TR><TD> 4363.209  <TD> [O_III] 4363<TD> zemission <TD> wemission  <TD>
 <TR><TD> 4861.325  <TD> H_beta      <TD> zemission <TD> w_balmer   <TD>
 <TR><TD> 4958.911  <TD> [O_III] 4959<TD> zemission <TD> wemission  <TD>
 <TR><TD> 5006.843  <TD> [O_III] 5007<TD> zemission <TD> wemission  <TD> 3 * ([O_III] 4959)
 <TR><TD> 6300.304  <TD> [O_I] 6300  <TD> zemission <TD> wemission  <TD>
 <TR><TD> 6363.776  <TD> [O_I] 6363  <TD> zemission <TD> wemission  <TD>
 <TR><TD> 6548.05   <TD> [N_II] 6548 <TD> zemission <TD> wemission  <TD>
 <TR><TD> 6562.801  <TD> H_alpha     <TD> zemission <TD> w_balmer   <TD>
 <TR><TD> 6583.45   <TD> [N_II] 6583 <TD> zemission <TD> wemission  <TD> 3 * ([N_II] 6548)
 <TR><TD> 6716.44   <TD> [S_II] 6716 <TD> zemission <TD> wemission  <TD>
 <TR><TD> 6730.82   <TD> [S_II] 6730 <TD> zemission <TD> wemission  <TD>
</TABLE>

<H2><A NAME="targetflags">What Are the Target Flags?</A></H2>

<P>
The target selection sets bits in two flags called PRIMTARGET and SECTARGET.
An object can have multiple bits set.  For example, if the target selection
code determined that an object was both a QSO_SKIRT and a STAR_WHITE_DWARF,
then two bits will be set.  The value of PRIMTARGET in this example will
be 2^4 + 2^19 = 524304.

<P>
Let's say you want to find all objects either targetted as a carbon star,
or spectroscopically classified as one.  All this information is in the
summary file "spAll.fits".  From IDL, one could search for these objects
and print their PLATE, MJD, and FIBERID as follows:
<DL><DD><PRE>
IDL> a = mrdfits('spAll.fits',1) ; This file should be in your current directory
IDL> i = where((a.primtarget AND 2L^14) NE 0)
IDL> print, transpose([[a[i].plate],[a[i].mjd],[a[i].fiberid]])

     [ Prints list of objects targetted as a Carbon star.]

IDL> i = where(strmatch(a.subclass, 'Carbon*') AND a.zwarning EQ 0)
IDL> print, transpose([[a[i].plate],[a[i].mjd],[a[i].fiberid]])

     [ Prints list of objects spectroscopically called a Carbon star.]
</PRE></DD></DL>

<P>
Now plot all of the objects found above:
<DL><DD><PRE>
IDL> i=0 & <A HREF="idlspec2d_doc.html#PLOTSPEC">plotspec</A>, a.plate, a.fiberid, mjd=a.mjd
</PRE></DD></DL>

<P>
The PRIMTARGET bit values are as follows (in hex and decimal):
<PRE>
  QSO_HIZ           = 0x1          = bit # 0 =        1
  QSO_CAP           = 0x2          = bit # 1 =        2
  QSO_SKIRT         = 0x4          = bit # 2 =        4
  QSO_FIRST_CAP     = 0x8          = bit # 3 =        8
  QSO_FIRST_SKIRT   = 0x10         = bit # 4 =       16
  QSO_MAG_OUTLIER   = 0x2000000    = bit #25 = 33554432
  QSO_REJECT        = 0x20000000   = bit #29 =536870912
  GALAXY_RED        = 0x20         = bit # 5 =       32
  GALAXY_RED_II     = 0x4000000    = bit #26 = 67108864
  GALAXY            = 0x40         = bit # 6 =       64
  GALAXY_BIG        = 0x80         = bit # 7 =      128
  GALAXY_BRIGHT_CORE= 0x100        = bit # 8 =      256
  ROSAT_A           = 0x200        = bit # 9 =      512
  ROSAT_B           = 0x400        = bit #10 =     1024
  ROSAT_C           = 0x800        = bit #11 =     2048
  ROSAT_D           = 0x1000       = bit #12 =     4096
  ROSAT_E           = 0x8000000    = bit #27 =134217728
  STAR_BHB          = 0x2000       = bit #13 =     8192
  STAR_CARBON       = 0x4000       = bit #14 =    16384
  STAR_BROWN_DWARF  = 0x8000       = bit #15 =    32768
  STAR_SUB_DWARF    = 0x10000      = bit #16 =    65536
  STAR_CATY_VAR     = 0x20000      = bit #17 =   131072
  STAR_RED_DWARF    = 0x40000      = bit #18 =   262144
  STAR_WHITE_DWARF  = 0x80000      = bit #19 =   524288
  STAR_PN           = 0x10000000   = bit #28 =268435456
  SERENDIP_BLUE     = 0x100000     = bit #20 =  1048576
  SERENDIP_FIRST    = 0x200000     = bit #21 =  2097152
  SERENDIP_RED      = 0x400000     = bit #22 =  4194304
  SERENDIP_DISTANT  = 0x800000     = bit #23 =  8388608
  SERENDIP_MANUAL   = 0x100000     = bit #24 = 16777216
  QSO_MAG_OUTLIER   = 0x200000     = bit #25 = 33554432
  GALAXY_RED_II     = 0x400000     = bit #26 = 67108864
  ROSAT_E           = 0x800000     = bit #27 =134217728
  STAR_PN           = 0x1000000    = bit #28 =268435456
  QSO_REJECT        = 0x2000000    = bit #29 =536870912
  SOUTHERN_SURVEY   = 0x8000000    = bit #31 =-2147483648
</PRE>

<P>
The SECTARGET bit values are as follows (in hex and decimal):
<PRE>
  LIGHT_TRAP        = 0x1          = bit # 0 =        1
  REDDEN_STD        = 0x2          = bit # 1 =        2
  TEST_TARGET       = 0x4          = bit # 2 =        4
  QA                = 0x8          = bit # 3 =        8
  SKY               = 0x10         = bit # 4 =       16
  SPECTROPHOTO_STD  = 0x20         = bit # 5 =       32
  GUIDE_STAR        = 0x40         = bit # 6 =       64
  BUNDLE_HOLE       = 0x80         = bit # 7 =      128
  QUALITY_HOLE      = 0x100        = bit # 8 =      256
  HOT_STD           = 0x200        = bit # 9 =      512
  SOUTHERN_SURVEY   = 0x8000000    = bit #31 =-2147483648
</PRE>

<P>
These flag values were copied from the "target" module files
"common/arTargetType.h" and "etc/diags.tcl".  (There doesn't actually
appear to be any single file tracks all of these flags!)

<H2><A NAME="vacuum">The Wavelengths Are in Vacuum!!??</A></H2>

<P>
Yes, the data are stored using <B>vacuum</B> wavelengths.  This makes sense
for quasologists.  But most optical astronomers know the wavelengths of
transitions as measured at S.T.P., which is how the CRC lists them for
any transitions redward of 2000 Angstroms.

<P>
The IAU standard for conversion from air to vacuum wavelengths is given
in Morton (1991, ApJS, 77, 119).  For vacuum wavelengths (VAC) in Angstroms,
convert to air wavelength (AIR) via:<BR>
<PRE>
  AIR = VAC / (1.0 + 2.735182E-4 + 131.4182 / VAC^2 + 2.76249E8 / VAC^4)
</PRE>

<P>
Below, I've listed the vacuum wavelength of some transitions:
<PRE>
 Air       Vacuum
 --------  --------
 4861.363  4862.721  H_beta
 4958.911  4960.295  [O III]
 5006.843  5008.239  [O III]
 6548.05   6549.86   [N II]
 6562.801  6564.614  H_alpha
 6583.45   6585.27   [N II]
 6716.44   6718.29   [S II]
 6730.82   6732.68   [S II]
</PRE>

<P>
Note that the wavelengths are also shifted such that measured velocities
will be relative to barycentric at the mid-point
of each 15-minute exposure (using TAI-BEG + 0.5 * EXPTIME from the header).
<H2><A NAME="problems">Problems</A></H2>

<H4><A NAME="problems_known">Known Problems</A></H4>

<P>
Here is a list of the most offensive known problems in Spectro-2D as
of version v4_8_4 (29 Aug 2001):
<PRE>
Plate 0187/51455 has no good b2 arc on the first night of data 51454.
Plate 0231/51456 has no good r1 arc on the first night of data 51455.
Plate 0202/51441 has the Red Monster light at 6400-6550 Ang, resulting
                 in some wrong z=4.3 QSO's (fibers 601,639).
Plate 0260/51612 looks like funny fluxing in the blue below 4000 Ang,
                 probably due to very low S/N.
Plate 0187/51455 has severe scattered light problems.  The r2 camera is
                 completely flagged as REDMONSTER in the ORMASK, and is
                 therefore ignored by the redshift-finding code.  For that
                 reason, the synthetic spectra do not match the spectra
                 at all for the red side of fibers 321-640.
Plate 0192/51461 has severe scattered light problems.
Plate 0202/51441 has the Red Monster light at 6400-6550 Ang in the last
                 2 of 4 exposures (exp #1367,1368).
                 Apparently 2 of the b1 science exposures saturated
                 (exp #1366,1367).  See PR #1890.
Plate 0214/51441 has the Red Monster light at 6400-6550 Ang in the first
                 3 of 4 exposures (exp #1356-1368).  See PR #1890.
Plate 0354/51792 taken during moon
Plate 0360/51780 had the b1 CCD warm up during exposures 6193,6194,6199
                 resulting in apparent scattered light in 6193,6194 and
                 rejection of frame 6199.  See PR #2170.
Plate 0426/51882 has the Red Monster light at 6400-6550 Ang in exp #7366-7367.
                 See PR #1890.
Plate 0541/51959 has bad extraction chi^2 and sky-subtraction, especially in r1.
Plate 0644/52149 has bad extraction chi^2 and sky-subtraction.  Is this the same
                 problem as for plate 0541/51959?
</PRE>

<H4><A NAME="problems_failed">Failed Plates</A></H4>

<PRE>
Plates 0179,0182 are FASTT plates with 12th mag stars and no sky fibers;
                 these data are not reducable.
Plate 0204/51455 has no good b1,b2,r2 arcs
Plate 0209/51462 has too many saturated rows in r2 for the modern reduction code
Plate 0213/51578 has no good b2 arc
Plate 0218/51461 has no good b2 arc
Plate 0235/51462 has no good b2 arc (saturated)
Plate 0260/51612 has only 2 science exposures, so will not combine
Plate 0284/51934 has no good arcs (flat-field screen was not closed for arcs);
                 no plan file even built
Plate 0296/51578 has no good b2 arc
Plate 0317/51589 has no flats or arcs; no plan file even built
Plate 0318 special plate needs edited plug-map files in order to run
Plate 0324/51616 only has one science exposure, so won't combine
Plate 0347/51701 has 1 saturated exposure on 51694, and 1 good one on 51701
Plate 0560/52045 only has one science exposure, so will not combine
</PRE>

<H4><A NAME="problems_dates">Dates and Plates to Remember</A></H4>

<PRE>
MJD -> 51569 (->25 Jan 2000): Shutter open during readout!
                   Definitely compromises data for plates 187,188,190,191,
                   192,194,198,202,203,217,231.
MJD -> 51605 (->2 Mar 2000): Scattered light from internal LED's contaminate
                   all these data.  After this date, we went through several
                   work-arounds that basically eliminated the problem.
                   Definitely compromises data for plates 187,188,190,191,
                   192,194,198,202,203,214,217,231,265,266,269,283,295.
MJD 51578 - 55580 (3-5 Feb 2000): Severe "shifted row" electronics problem.
                   This only effects plate 295/51580.
MJD 51584,51585,51608,51614,51615,51629,51630: Raw images are the wrong size!
                   Unsure what this actually does to the data.
                   Potentially effects plates 266,267,279,281,282,283,295,303.
MJD 51688 - 51703 (22 May 2000): Electronics "dropped pixel" problem
                   on cameras b2,r2.  Potentially effects plates 312,338,339,
                   343,344,346,348,349,351,353.
MJD 51779 only (22 Aug 2000): Terrible electronics problem on r2.
                   This only effects plate 356/51779.
MJD 51789 - today: (2 Sep 2000): Smear implemented for most plates, improving
                   spectro-photometry.
MJD 52220 - 52266, 52312 - 52356 (Nov-Dec 2001, Feb-Mar 2002) Spectrograph
                  slit-head latch problems.  The kinematic mounts for the
                  slit-heads were not always engaged, resulting in out-of-focus
                  exposures on the instrument.  The optimal extraction code
                  works quite poorly on these data, as does the sky-subtraction
                  which shows large relative chi^2 (MJD 52346 is the worst,
                  plates 790, 876, 889).

Plates   1 - 431: Tiling bug resulted in larger color range for SPECTROPHOTO
                  standards, which must compromise spectro-photometry
                  at some level.
Plates 371 - 416: Bad QSO selection due to bug in target v2_7 (chunk 8),
                  resulting in a very low success rate for quasars.
</PRE>

<H4><A NAME="problems_report">How to Report Problems</A></H4>

<P>
Problems can be reported via the bug database at:
<DL><DD><PRE>
<A HREF="http://spectro.princeton.edu/cgi-bin/gnatsweb.pl">
http://spectro.princeton.edu/cgi-bin/gnatsweb.pl</A>
</PRE></DD></DL>
File bugs about the extracted spectra against the category "idlspec2d",
and about the redshifts or template-fitting against "specBS".
Before filing a problem report (PR), first look at the
<A HREF="#problems_known">Known Problems</A> section above and
search the bug database to make sure no one else has already reported
the problem.

<HR>
<A HREF="http://astro.princeton.edu/~schlegel/">David Schlegel</A>,
<A HREF="mailto:schlegel@astro.princeton.edu">schlegel@astro.princeton.edu</A>
</ADDRESS>

</BODY>
</HTML>

