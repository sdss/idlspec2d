
* When combining files, set an additional mask bit for when part of a
  spectrum has been constructed with only one input spectrum.  In those
  cases, we don't have information for CR rejection.

* Improve mask bits for bright sky features.

* Use DJS_FILEPATH() where appropriate.

* Add /DEBUG keyword for writing out spArc and spFlat files.

* Apply illumination correction, as done for the PT.

* Look at plate 306, MJD 51637, fiber#295 (0-indexed 294).
  Appears that fluxing for b1 is bad redward of 6000 Ang.

* Remove WARNING, ABORT words from HTML file from APO2HTML.

* Preserve header info in APOREDUCE.

* Put back Scott's conservevariance terms in COMBINE2DOUT.

* Add keywords: INSTRUME ?

* Use a proc SDSSHEAD in place of HEADFITS, which calls SDSSPROC to get
  the header info correct (e.g., the CAMERA keyword).

* ATV bug displaying BYTE images, or NaN's

* Add HELIOCENTRIC code into current cvs.

* Reject masked or deviant sky fibers from the supersky (as done for superflat)

* In SPALLREDUCE, don't send the name UNKNOWN to COMBINE2DOUT.

* Measure relative shifts between all the flat-field traces in SPCALIB,
  then for each object pick the flat-field with the most similar traces.
  We can do this cheaply by measuring the offset to just the first good flat,
  then use the known relative shifts to pick the best match.

* Add in error as a fraction of the whopping terms?
  Or at least set a pixelmask bit.

* Bug in fitans image, do not get smooth fits for centershift and
     sigmashift, what is going on?

     --- Shifts were likely too large
     --- Now fitansimage is cleaner, and hopefully more robust

* Don't create pointers for SPCALIB, or if I do, then be sure to discard them
  with arcstruct_destroy(), flatstruct_destroy().

* Need to have better (or any) standard star SED prediction based
    on u-g, g-r, r-i.

       Look at: Stone, R. P. 1996, ApJS 107, 423, 
                Gunn & Stryker 

       BD17 is now assumed with AB_79 = 9.405

* Implement PSF variable sky subtraction

* trace_crude gives a wrong xstart for fiber 172 in 
    plate 192:  Tracing 320 fibers in sdR-r1-00001602.fit
    The fiber overlaps with fiber 171, but is not set as a
    bad fiber, so maybe this is why it is not fixed.

* Change FIBERMASK not in FIBERFLAT, but in SUPERFLAT.

* Try not to overwrite PostScript log file.

* BUG: For arc 51441/sdR-b2-00001347.fit (plate 214), bizarre wavelength
  solution!!  Were too many fibers rejected or something??
  This then shows up as horrible sky-subtraction!!
  Something must be broken in FITARCIMAGE or FINALARCFIT.
  Reverting to the old code, now the arc 51441/sdR-r2-00001347.fit
    looks somewhat poor in first 40 rows.  Damn it!

* BUG: The ends of the spectra have poor flux-calibration.  This is most
  obvious when one looks at the overlap of individual exposures.

  --> Could this be due to scattered light errors near the edge of frames?

* Put the arc-fitting QA logs into the QAPLOT code.

* Rationalize 01, 1b, b1 --> b1.

* Looks like combining now fails if blue side is missing (21-Dec-99).

* Do something fancier for overscan-correction?
  JEG points out that the b1 CCD has a terrible transient at the beginning.
  also first and last columns in all cameras.

* Track total exposure time in combined spectra
  some attempt is made, if both red and blue spectra are used in combining,
    total exposure time is exposure time of all / 2

* For the calibration op*.par files, make versions based upon MJD in /examples
    --- opECalib-51574.par  is up to date with latest gains.

* Make bad pixel masks for "opBC.par" file.
  Include bad pixels from pixflat.

* Plot the superflat vector as a QA plot

* Have FIBERFLAT only do a very low-order correction now that the
  flat fields are so much better.

----> Done (17-Dec-99).  Now only fit a cubic to each.
      But I'm still not using FIBERMASK everywhere I should.

* Don't allow too many whopping terms.

* Choose bkpts in combine2dout more carefully, bad behavior ensues
  with current choice (uniform bins).

* Fit spline to each spectrum before full combine2dout spline to
   register each spectrum in scale (including red/blue merge)

* Decide on vacuum or air wavelengths - document this!

* QA plot for how well the telluric-removal is doing

* Special-case a combine routine for only 2 exposures that will reject CR's

* Compare throughput from dome flats vs. throughput on bright sky lines.

----> Gaussians are fit to 5577 in each spectrum, after flat scaling

* Sky-subtraction: Fix edge effects in inverse variance scaling

* Measure gain + read noise

* Somehow measure nonlinearity + saturation.
  Maybe look at doublets with known line ratios?

* Measure system throughput (Q.E.) for g,r,i !!

* Look at the bias frames

* The b1 CCD has too much overscan subtracted on rows 0 and 1.
  Check all overscan regions in SDSSPROC.

* Need some logic to make certain we're looking at a flat, arc, etc.

* Focal plane mapping

* Output in header PSF information (spatial + wavelength) to final files.

-------------------------------------------------------------------------------
;   These have been dealt with
-------------------------------------------------------------------------------
* Need to pass rejection information back from extract_row.c
    to add into pixelmask

   ---> done, put in another parameter to return to extract_row.pro
          also put in rejection thresholds as a two elements array

* BUG: trace320crude is failing for fiber 276 on plate 217: sdR-r2-00001459.fit
    The xcen is off by > 1 pixel thr whole length of the fiber, and
    flat field extraction is horrible, object extraction is bad as well.

   ---> Should be fixed 03-Mar-00.

* CR zapping ---> Current code seems to deal with this.

* Problems with CCD electronics?  Bleads with low counts?
    -- This was the shutter open

* Characterize flexure 

* In flat-fields, be smarter with break points
  Also, tune pix-to-pix flat with global flat to be high-pass / low-pass filter

* When doing red/blue merging, apply a window function to the **variance**
  of each to smoothly merge the two.  E.g., at the long-wavelengths of blue,
  increase the variance -> infinity.
---->   current window of 100 pixels at red/blue merge is in place.

* Discard flats that saturate in SPREDUCE or SPPLAN.
----> Done (17-Dec-99) in SPREDUCE, but maybe should implement in SPPLAN?

* BUG: telluric_corr crashed on call to SLATEC_SPLINEFIT, because
  TEMPIVAR was all zeros.  Should test for this.  Failure was
  on 51433/plate#198/sdR-r1-00001137.fit.

-------------------------------------------------------------------------------
;   These are not likely to be done in near future:
-------------------------------------------------------------------------------
* Implement Proper variance (and covariance) terms in combine2dout
    -Larger problem of returning general covariance terms with
     slatec_efc and slatec_bvalu.  Probably requires doing customized
     B-spline fitting.  Also a change to deal with bkpts gracefully.

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------

2D Pre-Processing:
  * Overscan + bias subtraction
  * Pixel-to-pixel flat-fielding

2D Reductions:
  * Spatial tracing from flat-field image
      - Never, ever, ever mis-identify fiber numbers
      - Fit traces to smooth functions
      - Inspection of traces

  * Optimal extraction of flats, arcs, objects
      - Characterize PSF in spatial direction
      - Reject cosmics
      - Remove cross-talk

  * Wavelength calibration
      - Fit to arc lines + sky
      - Robust against bad centroids on some fibers
        (e.g., consistent fits between fibers)
      - Achieve < 0.4 pixel residuals (30 km/s)
      - Characterize PSF in wavelength direction

  * Flat-fielding
      - Remove fiber-to-fiber variations
      - Remove dichroic effects
      - Model relative wavelength response between fibers

  * Object extraction
      - Tweak spatial traces from flat -> object frame
      - Extraction: the "3 Step Plan"
        [1] Characterize exact spatial profile shape.
            Characterize scattered light.
        [2] Demand smoothly varying profiles (fit)
            Demand smoothly varying scattered light (fit)
        [3] Extract, fixing profile shape, center + scattered light terms
            e.g., ONLY fit flux level
      - Proper handling of bright objects.
        Use 1-param fit to exponential tails.

  * Sky-subtraction
      - Construct "super-sky"
      - Deal with the variable PSF

  * Telluric absorption removal
      - Template
      - Correction methods

  * Rebinning spectra + co-adding red+blue / multiple exposures
      - Deal with the variable PSF
      - More outlier rejection
      - Demonstrate no residuals from dichroic

  * Variance maps
      - Retain bad pixel info
      - Correct for flat-fielding
      - Include sky-sub variance term
      - Properly rebin along with the spectra

Code requirements (cf, "Requirements Document"):
   * Support on SDSS platforms
   * "Adequate development/debugging environment"
   * Code reliability
   * Code management (CVS, UPD)
   * Distribute code in "timely fashion"
   * Timing: Extract 1 night in < 1 day processing
   * Run tests on real data
   * Documentation

Data Model:
  * Which files are needed for reductions?
  * Which files are obsolete?
  * Fermi archiving issues.

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
Standalone routines:

readidlout

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
Unused routines:

combineI (old version of combine2dout?)
extract2
findobjects
fit_tset
fitwithmx (deprecated)
funccheb
gauss_smooth
read2dout
svdcheb
trace_fix
writeapid

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
Unused files in /etc:

BG14.txt
FG3.txt
altbg14.txt
fluxcorr.bkpts
intrinsic1.dat
intrinsicF2.dat
lamplist.dat

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
