
* BUG: For arc 51441/sdR-b2-00001347.fit (plate 214), bizarre wavelength
  solution!!  Were too many fibers rejected or something??
  This then shows up as horrible sky-subtraction!!
  Something must be broken in FITARCIMAGE or FINALARCFIT.

* BUG: The ends of the spectra have poor flux-calibration.  This is most
  obvious when one looks at the overlap of individual exposures.

* Make plot in QAPLOT_FFLAT smaller in the PostScript.

* Put the arc-fitting QA logs into the QAPLOT code.

* Let SUPERFLAT discard deviant (but not necessarily bad) fibers.

* Rationalize 01, 1b, b1 --> b1.

* Looks like combining now fails if blue side is missing (21-Dec-99).

* Do something fancier for overscan-correction?
  JEG points out that the b1 CCD has a terrible transient at the beginning.

* Track total exposure time in combined spectra

* For the calibration op*.par files, make versions based upon MJD in /examples

* Make bad pixel masks for "opBC.par" file.
  Include bad pixels from pixflat.

* Discard flats that saturate in SPREDUCE or SPPLAN.

----> Done (17-Dec-99) in SPREDUCE, but maybe should implement in SPPLAN?

* Combine "superflat" code from SPFLATTEN2 and FIBERFLAT.
  The internal routine SPFLATTEN2/SUPERFLAT could be called by FIBERFLAT.

----> Done (02-Jan-99)

* Plot the superflat vector as a QA plot

* Have FIBERFLAT only do a very low-order correction now that the
  flat fields are so much better.

----> Done (17-Dec-99).  Now only fit a cubic to each.
      But I'm still not using FIBERMASK everywhere I should.

* Don't allow too many whopping terms.

* When constructing FFLAT in FIBERFLAT, mask out very low values
  from the spline fits to avoid the large +/-/+ residuals.

* Choose bkpts in combine2dout more carefully, bad behavior ensues
  with current choice (uniform bins).

* Fit spline to each spectrum before full combine2dout spline to
   register each spectrum in scale (including red/blue merge)

* Decide on vacuum or air wavelengths - document this!

* Masked data has INVVAR=0, but then SIGMA=0 in the final outputs?
  What does spectro1d do with that?

* Let QUICKPROC be an option in SDSSPROC

* QA plot for how well the telluric-removal is doing

* When doing red/blue merging, apply a window function to the **variance**
  of each to smoothly merge the two.  E.g., at the long-wavelengths of blue,
  increase the variance -> infinity.

---->   current window of 100 pixels at red/blue merge is in place.

* Bug when writing out files:
  % Type conversion error: Unable to convert given STRING to Integer.
  % Detected at:  CHK_AND_UPD       206 
    /home/schlegel/evilspec/goddard/pro/fits/mwrfits.pro

* Special-case a combine routine for only 2 exposures that will reject CR's

* Count dead fibers in trace_crude

* Compare throughput from dome flats vs. throughput on bright sky lines.

----> Gaussians are fit to 5577 in each spectrum, after flat scaling

* Sky-subtraction: Fix edge effects in inverse variance scaling

* In flat-fields, be smarter with break points
  Also, tune pix-to-pix flat with global flat to be high-pass / low-pass filter

* Carry header around + add header cards

* Measure gain + read noise

* Somehow measure nonlinearity + saturation.
  Maybe look at doublets with known line ratios?

* Measure system throughput (Q.E.) for g,r,i !!

* Look at the bias frames

* The b1 CCD has too much overscan subtracted on rows 0 and 1.
  Check all overscan regions in SDSSPROC.

* CR zapping.

* Need some logic to make certain we're looking at a flat, arc, etc.

* Characterize flexure 

* Binned mode

* Problems with CCD electronics?  Bleads with low counts?

* Focal plane mapping

* Output in header PSF information (spatial + wavelength) to final files.

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------

2D Pre-Processing:
  * Overscan + bias subtraction
  * Pixel-to-pixel flat-fielding

2D Reductions:
  * Spatial tracing from flat-field image
      - Never, ever, ever mis-identify fiber numbers
      - Fit traces to smooth functions
      - Inspection of traces

  * Optimal extraction of flats, arcs, objects
      - Characterize PSF in spatial direction
      - Reject cosmics
      - Remove cross-talk

  * Wavelength calibration
      - Fit to arc lines + sky
      - Robust against bad centroids on some fibers
        (e.g., consistent fits between fibers)
      - Achieve < 0.4 pixel residuals (30 km/s)
      - Characterize PSF in wavelength direction

  * Flat-fielding
      - Remove fiber-to-fiber variations
      - Remove dichroic effects
      - Model relative wavelength response between fibers

  * Object extraction
      - Tweak spatial traces from flat -> object frame
      - Extraction: the "3 Step Plan"
        [1] Characterize exact spatial profile shape.
            Characterize scattered light.
        [2] Demand smoothly varying profiles (fit)
            Demand smoothly varying scattered light (fit)
        [3] Extract, fixing profile shape, center + scattered light terms
            e.g., ONLY fit flux level
      - Proper handling of bright objects.
        Use 1-param fit to exponential tails.

  * Sky-subtraction
      - Construct "super-sky"
      - Deal with the variable PSF

  * Telluric absorption removal
      - Template
      - Correction methods

  * Rebinning spectra + co-adding red+blue / multiple exposures
      - Deal with the variable PSF
      - More outlier rejection
      - Demonstrate no residuals from dichroic

  * Variance maps
      - Retain bad pixel info
      - Correct for flat-fielding
      - Include sky-sub variance term
      - Properly rebin along with the spectra

Code requirements (cf, "Requirements Document"):
   * Support on SDSS platforms
   * "Adequate development/debugging environment"
   * Code reliability
   * Code management (CVS, UPD)
   * Distribute code in "timely fashion"
   * Timing: Extract 1 night in < 1 day processing
   * Run tests on real data
   * Documentation

Data Model:
  * Which files are needed for reductions?
  * Which files are obsolete?
  * Fermi archiving issues.

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
Unused routines:

combineI (old version of combine2dout?)
extract2
findobjects
fit_tset
fitwithmx (deprecated)
funccheb
gauss_smooth
read2dout
readidlout
svdcheb
testextract
trace_fix
writeapid

-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
